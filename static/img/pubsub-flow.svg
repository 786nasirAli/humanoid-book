<svg width="800" height="400" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="100%" height="100%" fill="white" />

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#333">Publisher-Subscriber Communication Pattern</text>

  <!-- Publisher Node -->
  <g transform="translate(150, 100)">
    <rect x="0" y="0" width="150" height="80" rx="10" ry="10" fill="#2196F3" stroke="#0D47A1" stroke-width="3" />
    <text x="75" y="30" text-anchor="middle" font-size="16" fill="white" font-weight="bold">Publisher</text>
    <text x="75" y="55" text-anchor="middle" font-size="14" fill="white">Node A</text>
    <text x="75" y="75" text-anchor="middle" font-size="12" fill="white">(sensor/robot state)</text>
  </g>

  <!-- Subscriber Node -->
  <g transform="translate(500, 100)">
    <rect x="0" y="0" width="150" height="80" rx="10" ry="10" fill="#4CAF50" stroke="#2E7D32" stroke-width="3" />
    <text x="75" y="30" text-anchor="middle" font-size="16" fill="white" font-weight="bold">Subscriber</text>
    <text x="75" y="55" text-anchor="middle" font-size="14" fill="white">Node B</text>
    <text x="75" y="75" text-anchor="middle" font-size="12" fill="white">(controller/processor)</text>
  </g>

  <!-- ROS 2 Middleware/RMW -->
  <g transform="translate(325, 220)">
    <rect x="0" y="0" width="150" height="60" rx="10" ry="10" fill="#FFC107" stroke="#FF6F00" stroke-width="3" />
    <text x="75" y="25" text-anchor="middle" font-size="14" fill="#333" font-weight="bold">ROS 2</text>
    <text x="75" y="45" text-anchor="middle" font-size="14" fill="#333" font-weight="bold">Middleware</text>
  </g>

  <!-- Topic (Channel) -->
  <g transform="translate(350, 180)">
    <ellipse cx="50" cy="0" rx="70" ry="20" fill="#E1BEE7" stroke="#7B1FA2" stroke-width="2" />
    <text x="50" y="5" text-anchor="middle" font-size="14" fill="#333" font-weight="bold">/topic_name</text>
  </g>

  <!-- Arrow from Publisher to Topic -->
  <line x1="300" y1="140" x2="400" y2="180" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)" />
  <text x="350" y="160" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">Publish</text>

  <!-- Arrow from Topic to Subscriber -->
  <line x1="420" y1="180" x2="500" y2="140" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)" />
  <text x="460" y="160" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">Subscribe</text>

  <!-- Arrow from Publisher to Middleware (for status updates) -->
  <line x1="300" y1="150" x2="400" y2="230" stroke="#795548" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)" />
  <text x="350" y="190" text-anchor="middle" font-size="10" fill="#795548">Status Update</text>

  <!-- Arrow from Middleware to Subscriber (for notifications) -->
  <line x1="400" y1="250" x2="500" y2="150" stroke="#795548" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)" />
  <text x="450" y="200" text-anchor="middle" font-size="10" fill="#795548">Notification</text>

  <!-- Message Flow Example -->
  <g transform="translate(375, 120)">
    <rect x="0" y="0" width="100" height="40" fill="#FFFFFF" stroke="#333" stroke-width="2" rx="5" ry="5" />
    <text x="50" y="25" text-anchor="middle" font-size="14" fill="#333">Message</text>
  </g>

  <!-- Arrow showing message flow -->
  <line x1="425" y1="140" x2="425" y2="180" stroke="#FF0000" stroke-width="3" marker-end="url(#arrowhead)" stroke-dasharray="5,5" />
  <text x="440" y="160" text-anchor="start" font-size="10" fill="#FF0000">Message Flow</text>

  <!-- Arrow marker definitions -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <!-- Legend -->
  <g transform="translate(50, 320)">
    <rect x="0" y="0" width="250" height="70" fill="none" stroke="#333" stroke-width="1" />
    
    <g transform="translate(10, 15)">
      <rect x="0" y="0" width="20" height="10" fill="#2196F3" stroke="#0D47A1" />
      <text x="30" y="10" font-size="12" fill="#333">Publisher Node</text>
    </g>
    
    <g transform="translate(130, 15)">
      <rect x="0" y="0" width="20" height="10" fill="#4CAF50" stroke="#2E7D32" />
      <text x="30" y="10" font-size="12" fill="#333">Subscriber Node</text>
    </g>
    
    <g transform="translate(10, 35)">
      <ellipse cx="10" cy="5" rx="10" ry="5" fill="#E1BEE7" stroke="#7B1FA2" />
      <text x="30" y="10" font-size="12" fill="#333">Topic/Channel</text>
    </g>
    
    <g transform="translate(130, 35)">
      <rect x="0" y="0" width="20" height="10" fill="#FFC107" stroke="#FF6F00" />
      <text x="30" y="10" font-size="12" fill="#333">ROS Middleware</text>
    </g>
  </g>

  <!-- Communication Pattern Description -->
  <g transform="translate(500, 320)">
    <text x="0" y="0" font-size="14" fill="#333" font-weight="bold">Communication Pattern</text>
    <text x="0" y="20" font-size="12" fill="#333">• One-to-many communication</text>
    <text x="0" y="35" font-size="12" fill="#333">• Asynchronous messaging</text>
    <text x="0" y="50" font-size="12" fill="#333">• Decoupled nodes</text>
  </g>
</svg>