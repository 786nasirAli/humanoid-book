<svg width="800" height="500" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="100%" height="100%" fill="white" />

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#333">Python Agent to ROS 2 Controller Communication</text>

  <!-- Agent Section -->
  <g transform="translate(100, 100)">
    <rect x="0" y="0" width="250" height="350" fill="#E3F2FD" stroke="#1976D2" stroke-width="3" rx="10" ry="10" />
    <text x="125" y="30" text-anchor="middle" font-size="16" font-weight="bold" fill="#333">Python Agent</text>
    
    <!-- Agent Components -->
    <g transform="translate(20, 60)">
      <rect x="0" y="0" width="210" height="50" fill="#BBDEFB" stroke="#1976D2" stroke-width="2" rx="5" ry="5" />
      <text x="105" y="30" text-anchor="middle" font-size="14" fill="#333">AI/Decision Logic</text>
    </g>
    
    <g transform="translate(20, 130)">
      <rect x="0" y="0" width="210" height="50" fill="#BBDEFB" stroke="#1976D2" stroke-width="2" rx="5" ry="5" />
      <text x="105" y="30" text-anchor="middle" font-size="14" fill="#333">Command Generator</text>
    </g>
    
    <g transform="translate(20, 200)">
      <rect x="0" y="0" width="210" height="50" fill="#BBDEFB" stroke="#1976D2" stroke-width="2" rx="5" ry="5" />
      <text x="105" y="30" text-anchor="middle" font-size="14" fill="#333">ROS 2 Publisher</text>
    </g>
    
    <!-- Agent Code Example -->
    <g transform="translate(20, 270)">
      <rect x="0" y="0" width="210" height="70" fill="#E1F5FE" stroke="#0288D1" stroke-width="1" rx="3" ry="3" />
      <text x="5" y="15" font-family="monospace" font-size="10" fill="#333">cmd_msg = JointState()</text>
      <text x="5" y="30" font-family="monospace" font-size="10" fill="#333">cmd_msg.position = [0.5, -0.3, 0.2]</text>
      <text x="5" y="45" font-family="monospace" font-size="10" fill="#333">publisher.publish(cmd_msg)</text>
    </g>
  </g>

  <!-- Controller Section -->
  <g transform="translate(450, 100)">
    <rect x="0" y="0" width="250" height="350" fill="#E8F5E8" stroke="#388E3C" stroke-width="3" rx="10" ry="10" />
    <text x="125" y="30" text-anchor="middle" font-size="16" font-weight="bold" fill="#333">ROS 2 Controller</text>
    
    <!-- Controller Components -->
    <g transform="translate(20, 60)">
      <rect x="0" y="0" width="210" height="50" fill="#C8E6C9" stroke="#388E3C" stroke-width="2" rx="5" ry="5" />
      <text x="105" y="30" text-anchor="middle" font-size="14" fill="#333">ROS 2 Subscriber</text>
    </g>
    
    <g transform="translate(20, 130)">
      <rect x="0" y="0" width="210" height="50" fill="#C8E6C9" stroke="#388E3C" stroke-width="2" rx="5" ry="5" />
      <text x="105" y="30" text-anchor="middle" font-size="14" fill="#333">Command Processor</text>
    </g>
    
    <g transform="translate(20, 200)">
      <rect x="0" y="0" width="210" height="50" fill="#C8E6C9" stroke="#388E3C" stroke-width="2" rx="5" ry="5" />
      <text x="105" y="30" text-anchor="middle" font-size="14" fill="#333">Hardware Interface</text>
    </g>
    
    <!-- Controller Code Example -->
    <g transform="translate(20, 270)">
      <rect x="0" y="0" width="210" height="70" fill="#E8F5E8" stroke="#388E3C" stroke-width="1" rx="3" ry="3" />
      <text x="5" y="15" font-family="monospace" font-size="10" fill="#333">def cmd_callback(self, msg):</text>
      <text x="5" y="30" font-family="monospace" font-size="10" fill="#333">  joints = msg.position</text>
      <text x="5" y="45" font-family="monospace" font-size="10" fill="#333">  self.execute_commands(joints)</text>
    </g>
  </g>

  <!-- Communication Channel -->
  <g transform="translate(350, 200)">
    <ellipse cx="50" cy="0" rx="60" ry="20" fill="#FFF9C4" stroke="#F57F17" stroke-width="2" />
    <text x="50" y="5" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">/joint_commands</text>
  </g>

  <!-- Communication Arrows -->
  <!-- Agent to Controller (Commands) -->
  <line x1="350" y1="220" x2="450" y2="220" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)" />
  <text x="400" y="210" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">Commands</text>

  <!-- Controller to Agent (Feedback) -->
  <line x1="450" y1="260" x2="350" y2="260" stroke="#795548" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead2)" />
  <text x="400" y="250" text-anchor="middle" font-size="10" fill="#795548">Feedback</text>

  <!-- Arrow marker definitions -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="1" refY="3.5" orient="auto">
      <polygon points="10 0, 0 3.5, 10 7" fill="#795548" />
    </marker>
  </defs>

  <!-- Data Flow Example -->
  <g transform="translate(375, 150)">
    <rect x="0" y="0" width="100" height="40" fill="#FFFFFF" stroke="#333" stroke-width="2" rx="5" ry="5" />
    <text x="50" y="25" text-anchor="middle" font-size="12" fill="#333">Joint Commands</text>
  </g>

  <!-- QoS Configuration -->
  <g transform="translate(50, 470)">
    <rect x="0" y="0" width="700" height="25" fill="#FFF3E0" stroke="#FF8F00" stroke-width="1" />
    <text x="350" y="17" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">Quality of Service (QoS) Settings: Reliability=RELIABLE, Durability=VOLATILE, Depth=10</text>
  </g>

  <!-- Message Types -->
  <g transform="translate(300, 400)">
    <rect x="0" y="0" width="200" height="60" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="2" />
    <text x="100" y="20" text-anchor="middle" font-size="14" fill="#333" font-weight="bold">Message Types</text>
    <text x="100" y="45" text-anchor="middle" font-size="12" fill="#333">sensor_msgs/JointState, geometry_msgs/Twist, etc.</text>
  </g>

  <!-- Communication Layers -->
  <g transform="translate(100, 470)">
    <text x="0" y="0" font-size="12" fill="#333" font-weight="bold">Communication Stack:</text>
    <text x="0" y="15" font-size="10" fill="#333">Python Agent → rclpy → DDS Middleware → ROS 2 Controller</text>
  </g>
</svg>